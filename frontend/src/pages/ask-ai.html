<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Buno Ask AI</title>
  <style>
    :root {
      --bg: #05080f;
      --panel: #0b1320;
      --panel-2: #0e1a2d;
      --text: #d6e4ff;
      --muted: #7e95b5;
      --blue: #1e8bff;
      --blue-soft: #123a66;
      --border: #17314f;
      --user: #0c4a8f;
      --bot: #111b2c;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at top, #0b1a2f 0%, var(--bg) 55%);
      color: var(--text);
      display: grid;
      place-items: center;
      padding: 16px;
    }

    .app {
      width: min(900px, 100%);
      height: min(92vh, 860px);
      border: 1px solid var(--border);
      background: linear-gradient(180deg, var(--panel) 0%, #080f1b 100%);
      border-radius: 16px;
      overflow: hidden;
      display: grid;
      grid-template-rows: auto 1fr auto;
      box-shadow: 0 18px 50px rgba(0, 0, 0, 0.45);
    }

    .topbar {
      border-bottom: 1px solid var(--border);
      padding: 14px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 14px;
      background: rgba(8, 17, 29, 0.9);
    }

    .ask-tile {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      background: #091f3a;
      border: 1px solid #1c4f86;
      color: #beddff;
      border-radius: 12px;
      padding: 10px 14px;
      font-weight: 700;
      letter-spacing: 0.4px;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--blue);
      box-shadow: 0 0 12px var(--blue);
    }

    .backend {
      display: flex;
      gap: 8px;
      width: min(520px, 100%);
    }

    .backend input {
      flex: 1;
      background: #07101d;
      border: 1px solid #22476f;
      color: #c4d7f5;
      border-radius: 10px;
      padding: 9px 10px;
      font-size: 12px;
    }

    .chat {
      overflow-y: auto;
      padding: 18px 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      background-image:
        linear-gradient(rgba(20, 43, 71, 0.08) 1px, transparent 1px),
        linear-gradient(90deg, rgba(20, 43, 71, 0.08) 1px, transparent 1px);
      background-size: 22px 22px;
    }

    .msg-row {
      display: flex;
      width: 100%;
    }

    .msg-row.user {
      justify-content: flex-end;
    }

    .msg-row.bot {
      justify-content: flex-start;
    }

    .bubble {
      max-width: 78%;
      border-radius: 14px;
      padding: 10px 12px;
      line-height: 1.4;
      border: 1px solid rgba(255, 255, 255, 0.08);
      word-wrap: break-word;
      white-space: pre-wrap;
    }

    .msg-row.user .bubble {
      background: linear-gradient(160deg, #0d4f95 0%, #0a3d74 100%);
      border-color: #2168b5;
      color: #eaf4ff;
      border-bottom-right-radius: 4px;
    }

    .msg-row.bot .bubble {
      background: linear-gradient(160deg, #121d30 0%, #0d1727 100%);
      border-color: #223855;
      color: #d0ddf2;
      border-bottom-left-radius: 4px;
    }

    .meta {
      margin-top: 6px;
      color: #8ba7ce;
      font-size: 11px;
    }

    .controls {
      border-top: 1px solid var(--border);
      background: rgba(9, 16, 28, 0.95);
      padding: 12px;
      display: grid;
      gap: 8px;
    }

    .control-row {
      display: grid;
      grid-template-columns: 1fr auto auto auto;
      gap: 8px;
    }

    select,
    input,
    button {
      border-radius: 10px;
      border: 1px solid #22476f;
      background: #081324;
      color: #d6e4ff;
      padding: 10px;
      outline: none;
    }

    button {
      background: linear-gradient(180deg, #1e8bff 0%, #166ec9 100%);
      border-color: #3e98fa;
      font-weight: 700;
      cursor: pointer;
      min-width: 92px;
    }

    button:hover {
      filter: brightness(1.08);
    }

    .hint {
      color: var(--muted);
      font-size: 12px;
      padding-left: 2px;
    }

    @media (max-width: 760px) {
      .app {
        height: 96vh;
      }

      .topbar {
        flex-direction: column;
        align-items: stretch;
      }

      .control-row {
        grid-template-columns: 1fr;
      }

      .bubble {
        max-width: 90%;
      }
    }
  </style>
</head>
<body>
  <main class="app">
    <header class="topbar">
      <div class="ask-tile"><span class="dot"></span> ASK AI</div>
      <div class="backend">
        <input id="backendUrl" type="text" />
      </div>
    </header>

    <section id="chat" class="chat"></section>

    <footer class="controls">
      <div class="control-row">
        <input id="message" type="text" placeholder="Type your message..." />
        <select id="mode">
          <option value="guide">Guide</option>
          <option value="listen">Just Listen</option>
        </select>
        <select id="personality">
          <option value="calm">Calm</option>
          <option value="cheerful">Cheerful</option>
          <option value="motivational">Motivational</option>
        </select>
        <button id="sendBtn">Send</button>
      </div>
      <p class="hint">WhatsApp-style chat UI. Black + blue theme. Connected to Hugging Face backend `/chat`.</p>
    </footer>
  </main>

  <script>
    const HF_BACKEND = "https://deepak0y-buno-ai.hf.space";
    const backendInput = document.getElementById("backendUrl");
    const chat = document.getElementById("chat");
    const messageInput = document.getElementById("message");
    const modeInput = document.getElementById("mode");
    const personalityInput = document.getElementById("personality");
    const sendBtn = document.getElementById("sendBtn");

    const defaultBackend = window.location.hostname.includes("hf.space")
      ? window.location.origin
      : HF_BACKEND;

    backendInput.value = defaultBackend;

    function escapeHtml(str) {
      return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/\"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function addMessage(kind, text, meta = "") {
      const row = document.createElement("div");
      row.className = `msg-row ${kind}`;

      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.innerHTML = `${escapeHtml(text)}${meta ? `<div class=\"meta\">${escapeHtml(meta)}</div>` : ""}`;

      row.appendChild(bubble);
      chat.appendChild(row);
      chat.scrollTop = chat.scrollHeight;
    }

    async function sendMessage() {
      const text = messageInput.value.trim();
      if (!text) return;

      addMessage("user", text);
      messageInput.value = "";
      sendBtn.disabled = true;
      addMessage("bot", "Typing...");

      const endpoint = `${backendInput.value.replace(/\/$/, "")}/chat`;

      try {
        const res = await fetch(endpoint, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            user_id: "web-user",
            message: text,
            mode: modeInput.value,
            personality: personalityInput.value,
          }),
        });

        const typing = chat.lastElementChild;
        if (typing) chat.removeChild(typing);

        if (!res.ok) {
          const err = await res.text();
          addMessage("bot", `Request failed (${res.status})`, err.slice(0, 220));
          return;
        }

        const data = await res.json();
        const meta = `emotion: ${data?.emotion?.emotion_label || "n/a"} | stress: ${data?.stress?.stress_level || "n/a"}`;
        addMessage("bot", data.response || "No response", meta);
      } catch (error) {
        const typing = chat.lastElementChild;
        if (typing) chat.removeChild(typing);
        addMessage("bot", "Could not reach backend.", String(error));
      } finally {
        sendBtn.disabled = false;
        messageInput.focus();
      }
    }

    addMessage("bot", "Hi, I am Buno. How are you feeling today?");

    sendBtn.addEventListener("click", sendMessage);
    messageInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") sendMessage();
    });
  </script>
</body>
</html>
